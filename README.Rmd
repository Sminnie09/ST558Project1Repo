---
title: "ST558 Project 1"
author: "Noel Hilliard"
date: "6/5/2020"
output:
  rmarkdown::github_document
---

Project Objective: This project involves creating a vignette (an HTML file with a table of contents) about reading in data in JSON format and exploring it (summaries and graphs - more details on this later). You will then create a blog post linking to your vignette.All project work should be done in a github repo. 

**Table of Contents**

* [JSON Data](#markdown-header-JSON-Data)
* [Functions](#markdown-header-Functions)

# JSON Data

## What is it?

JavaScript Object Notation (JSON) data is a lightweight data-interchange format used to store data. According to [JSON.org](https://www.json.org/json-en.html), JSON data has two data structures that are recognized by all programming languages: (1) A collection of name/value pairs (2) An ordered list of values. The first data structure is recognized as "an object, record, struct, dictionary, hash table, keyed list, or associative array." The second data structure is recognized as "an array, vector list, or sequence." JSON data is a text format that does not depend on language so it is compatible with several languages including C, C++, C#, Java, JavaScript, Perl, and Python.[(JSON.org)](https://www.json.org/json-en.html)

## Where does it get used?

JSON data is used for a variety of applications. JSON data format can be used for browser extensions and websites that are written in JavaScript. It can be used as an alternate data format for XML to transmit data between the client and server in web applications. Other web applications include the use of JSON data in programming of Web Services and APIs to provide access to public data. Lastly, JSON data is used for serialization and transmission of the structured data over the network.(https://blog.eduonix.com/web-programming-tutorials/learn-use-json/)


## Why is it a good way to store data?

JSON data is a good way to store data because it is a text only format. The format can be conveniently transferred with servers and JSON is a data format that can be used by any programming language. (https://www.w3schools.com/js/js_json_intro.asp)


# Functions

```{r Install Packages, echo = TRUE, message = FALSE}

#install.packages("httr")

library("httr")

#install.packages("jsonlite")

library("jsonlite")
```

## Franchise Data from API
```{r franchise function, echo = TRUE}
getFranchise <- function(){

  base_url <- "https://records.nhl.com/site/api"
  tab_name <- "franchise"
  full_url <- paste0(base_url, "/", tab_name)

  get_franchise <- GET(full_url)

  get_franchise_text <- content(get_franchise, "text")

  get_franchise_json <- fromJSON(get_franchise_text, flatten = TRUE)

  return(data.frame(get_franchise_json))
}

```


## Franchise Team Totals Data from API
```{r FranchiseTeamTotals, echo = TRUE}
getTeamTotals <- function(){
  
  base_url <- "https://records.nhl.com/site/api"
  tab_name <- "franchise-team-totals"
  full_url <- paste0(base_url, "/", tab_name)

  get_TeamTotals <- GET(full_url)

  get_TeamTotals_text <- content(get_TeamTotals, "text")

  get_TeamTotals_json <- fromJSON(get_TeamTotals_text, flatten = TRUE)
  
  return(data.frame(get_TeamTotals_json))
  
}
```

## Franchise Season Records Data from API
```{r FranchiseSeasonRecords, echo = TRUE}
getSeasonRecords <- function(FranchiseID){
  
 
  base_url <- "https://records.nhl.com/site/api"
  tab_name <- "franchise-season-records?cayenneExp=franchiseId="
  full_url <- paste0(base_url, "/", tab_name, FranchiseID)

  get_SeasonRecords <- GET(full_url)

  get_SeasonRecords_text <- content(get_SeasonRecords, "text")

  get_SeasonRecords_json <- fromJSON(get_SeasonRecords_text, flatten = TRUE)
 
  return(data.frame(get_SeasonRecords_json))
  
}

```

## Franchise Goalie Records Data from API

```{r GoalieRecords, echo = TRUE}
getGoalieRecords <- function(FranchiseID){
  
  base_url <- "https://records.nhl.com/site/api"
  tab_name <- "franchise-goalie-records?cayenneExp=franchiseId="
  full_url <- paste0(base_url, "/", tab_name, FranchiseID)

  get_GoalieRecords <- GET(full_url)

  get_GoalieRecords_text <- content(get_GoalieRecords, "text")

  get_GoalieRecords_json <- fromJSON(get_GoalieRecords_text, flatten = TRUE) 
  
  return(data.frame(get_GoalieRecords_json))
}

```

## Franchise Skater Records Data from API

```{r SkaterRecords, echo = TRUE}
getSkaterRecords <- function(FranchiseID){
  
  base_url <- "https://records.nhl.com/site/api"
  tab_name <- "franchise-skater-records?cayenneExp=franchiseId="
  full_url <- paste0(base_url, "/", tab_name, FranchiseID)

  get_SkaterRecords <- GET(full_url)

  get_SkaterRecords_text <- content(get_SkaterRecords, "text")

  get_SkaterRecords_json <- fromJSON(get_SkaterRecords_text, flatten = TRUE) 
  
  return(data.frame(get_SkaterRecords_json))
}

```

# Contingency Tables 

## Active and Inactive Players in Goalie Records for Select Franchises

```{r goalie records counts table, echo = TRUE, message = FALSE}
library(knitr) #Load knirt r package

#Create dataframe of goalie records for select franchises
GoalieRecords <- rbind(getGoalieRecords(5),getGoalieRecords(10), getGoalieRecords(20), getGoalieRecords(25), getGoalieRecords(15), getGoalieRecords(22))

#factor columns of interest
GoalieRecords$data.activePlayer <- factor(GoalieRecords$data.activePlayer)
GoalieRecords$data.franchiseName <- factor(GoalieRecords$data.franchiseName)

#create table
kable(table(GoalieRecords$data.franchiseName,GoalieRecords$data.activePlayer), 
      col.names = c("Inactive Player", "Active Player"))
```

## Positions in Skater Records for Select Franchises

```{r position by franchise, echo TRUE, message = FALSE}

#Create dataframe of goalie records for select franchises
SkaterRecords <- rbind(getSkaterRecords(5), getSkaterRecords(10), getSkaterRecords(20),getSkaterRecords(25), getSkaterRecords(15), getSkaterRecords(22))

#factor columns of interest
SkaterRecords$data.franchiseName <- factor(SkaterRecords$data.franchiseName)
SkaterRecords$data.positionCode <- factor(SkaterRecords$data.positionCode)

#create table
kable(table(SkaterRecords$data.franchiseName, SkaterRecords$data.positionCode))

```

# Numeric Summaries

## Numeric Summary of Select Columns from Skater Records

```{r stat sum skater records function, echo = TRUE, message = FALSE}
library(dplyr)

SkatersTable <- function(position){
  data <- getSkaterRecords(5) %>% filter(data.positionCode == position) %>% select(data.assists,data.gamesPlayed, data.goals, data.points, data.seasons)
  kable(apply(data, 2, summary))
}

```

```{r position numeric summary L, echo = TRUE, message = FALSE}
SkatersTable("L")
```

```{r position numeric summary C, echo = TRUE, message = FALSE}
SkatersTable("C")
```

```{r position numeric summary D, echo = TRUE, message = FALSE}
SkatersTable("D")
```

```{r position numeric summary R, echo = TRUE, message = FALSE}
SkatersTable("R")
```

## Barplot

```{r Skater bar plot, echo = TRUE, message = FALSE}
library(ggplot2) #load ggplot for plots

#dataframe of subset of skater records 
SkaterRecords <- rbind(getSkaterRecords(5), getSkaterRecords(10), getSkaterRecords(20),getSkaterRecords(25), getSkaterRecords(15), getSkaterRecords(22))

#rename factor levels
SkaterRecords$data.activePlayer <- factor(SkaterRecords$data.activePlayer)
player_new <- c("Inactive Player", "Active Player")
levels(SkaterRecords$data.activePlayer) <- player_new

#
g <- ggplot(data = SkaterRecords, aes(x = data.franchiseName))
g + geom_bar(aes(fill = data.activePlayer), position = "dodge") + labs(x = "Franchise Name", fill = "") + theme(axis.text.x = element_text(size = 10, angle = 90))
```

## Boxplot

```{r losses boxplot, echo = TRUE, message = FALSE}

#create dataframe of select franchises from goalie records
GoalieRecords <- rbind(getGoalieRecords(5),getGoalieRecords(10), getGoalieRecords(20), getGoalieRecords(25), getGoalieRecords(15), getGoalieRecords(22))

#create barplot
g <- ggplot(GoalieRecords, aes(x = data.franchiseName, y = data.losses))
g + geom_boxplot() + theme(axis.text.x = element_text(size = 10, angle = 90)) + labs(x = "Franchise Name", y = "Losses")


```

## Scatter Plot

```{r scatter plot, echo = TRUE, message = FALSE}

SkaterRecords <- rbind(getSkaterRecords(23), getSkaterRecords(16), getSkaterRecords(3), getSkaterRecords(6))

g <- ggplot(SkaterRecords, aes(x = data.gamesPlayed, y = data.mostGoalsOneSeason))
g + geom_point(aes(color = data.franchiseName)) + labs(x = "Games Played", y = "Most Goals in One Season", color = "Franchise Name")

```

